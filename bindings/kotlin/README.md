# Kotlin bindings for `ddnnife`

## Usage

### Java Utils

Some Kotlin methods (such as as `Ddnnf.fromFile`) don't have a direct translation to Java because of their signature.
Instead, the `JavaUtils` class provides access to these methods with Java parameters.
When using such methods, it needs to be ensured that the parameters have correct values as they might throw exceptions otherwise.

## Build

**Note:**
The Kotlin bindings can also be built using Nix, see the main README for details.

### Requirements

- [Rust][rust] (or prebuilt `ddnnife` libraries and `uniffi-bindgen`)
- [Gradle][gradle]

There are two ways to build the bindings:
Locally by building the Rust library first, or by passing a directory containing the pre-built libraries.

### Locally

```
gradle build
```

This will invoke a Rust build of `ddnnife`, generate the Kotlin bindings by running `ddnnife-bindgen` via cargo.

### Pre-built

With a directory containing the pre-built libraries for each platform in the following layout (at least the host platform is required):

```
/path/to/prebuilt/libraries
├── darwin-aarch64
│   └── libddnnife.dylib
├── darwin-x86-64
│   └── libddnnife.dylib
├── linux-aarch64
│   └── libddnnife.so
└── linux-x86-64
    └── libddnnife.so
```

... running the following will build the bindings without a Rust build of `ddnnife`

```
gradle build -Plibraries=/path/to/prebuilt/libraries
```

### `uniffi-bindgen`

By default, the Gradle build will run the corresponding crate in this workspace via cargo.
To prevent this, a command/path to the `uniffi-bindgen` binary can be provided:

```
gradle build -Pbindgen=/path/to/uniffi-bindgen
```

Using this together with the pre-built libraries a Gradle built without any Rust invocation is possible.

### Generated sources

The `de.softvare.ddnnife` package in `src/main/kotlin` is generated by `uniffi` but kept in this location for better compliance with tools like [Dokka][dokka].
It will be auto-generated by Gradle and should not be committed into Git.

[jna]: https://github.com/java-native-access/jna
[rust]: https://www.rust-lang.org
[gradle]: https://gradle.org
[dokka]: https://kotlinlang.org/docs/dokka-introduction.html
